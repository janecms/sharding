## 14. 说一下数据库的索引。数据库隔离级别。
### 14.1数据库索引
索引是对数据库表中的一列或多列的值，进行排序的一种结构 ，使用索引可以快速访问数据库表中的特定信息，是加快数据库查询的技术。
索引的优缺点
优点
- 1.索引可以避免全表扫描；
- 2.大大提高数据检索的速度
缺点
- 1.需要耗费时间的，这种时间会随着数据量的增加而增加
- 2.当表中的数据进行增加、删除和修改的时候，索引也要动态地维护，这样就降低了数据的维护速度
索引类型
- 1.normal：表示普通索引
- 2.unique：表示唯一的，不允许重复的索引。
- 3.full textl: 表示 全文搜索的索引。 
索引结构
- 1.Hash索引:哈希索引只有Memory, NDB两种引擎支持，Memory引擎默认支持哈希索引，如果多个hash值相同，出现哈希碰撞，那么索引以链表方式存储。
	哈希索引就是采用一定的哈希算法，把键值换算成新的哈希值，检索时不需要类似B+树那样从根节点到叶子节点逐级查找，只需一次哈希算法即可立刻定位到相应的位置，速度非常快。
- 2.B-Tree索引:最为频繁的索引类型，除了 Archive 存储引擎之外的其他所有的存储引擎都支持 B-Tree 索引
- 3.oracle有位图索引。适用于选择基数小的列。

### 14.2数据库隔离级别

	事务隔离（英语：Transaction Isolation）定义了数据库系统中一个操作的结果在何时以何种方式对其他并发操作可见。
	隔离是事务ACID（原子性、一致性性、隔离性、持久性）四大属性之一。
- 1.未提交读（READ UNCOMMITTED）是最低的隔离级别。允许“脏读”（dirty reads），事务可以看到其他事务“尚未提交”的修改。
- 2.提交读（READ COMMITTED） 基于锁机制并发控制的DBMS需要对选定对象的写锁一直保持到事务结束，但是读锁在SELECT操作完成后马上释放。“不可重复读”现象可能会发生。
- 3.可重复读（REPEATABLE READS）基于锁机制并发控制的DBMS需要对选定对象的读锁（read locks）和写锁（write locks）一直保持到事务结束，但不要求“范围锁”，因此可能会发生“幻影读”
- 4.可序列化 是最低的隔离级别。允许“脏读”（dirty reads），事务可以看到其他事务“尚未提交”的修改。要求在选定对象上的读锁和写锁保持直到事务结束后才能释放。
	在SELECT 的查询中使用一个“WHERE”子句来描述一个范围时应该获得一个“范围锁”（range-locks）。这种机制可以避免“幻影读”（phantom reads）现象

隔离级别vs 锁持续时间
在基于锁的并发控制中，隔离级别决定了锁的持有时间。"C"-表示锁会持续到事务提交。 "S" –表示锁持续到当前语句执行完毕。
如果锁在语句执行完毕就释放则另外一个事务就可以在这个事务提交前修改锁定的数据，从而造成混乱。

|  隔离级别  	|	写操作	|  	读操作	|	范围操作 				|
| ------------- |:---------:| -----:  	| ------------------:		|
|  未提交读 	|	S 		|  	 S 		|	S 						|
|  提交读	  	|   C  		|    S 		|	S 						|
|  可重复读 	|   C 		|    C 		|   S 						|
|  可序列化  	|   C 		|    C		|   C						|

不同的DBMS默认隔离级别也不同。大多数据库允许用户设置隔离级别
```
transaction-isolation = {READ-UNCOMMITTED | READ-COMMITTED | REPEATABLE-READ | SERIALIZABLE}
oracle默认级别为：READ-COMMITTED
InnoDB默认级别为：REPEATABLE-READ
```
## 15.statement 与 PreparedStatement 的区别。
- 1.Statement可以正常访问数据库，适用于运行静态 SQL 语句。 Statement 接口不接受参数。
- 2.PreparedStatement预编译的,运行时接受输入的参数,适用于批量处理
- 3.PreparedStatement 对象的开销比Statement大，对于一次性操作并不会带来额外的好处。
- 4.PreparedStatement对象的参数可以被强制进行类型转换，更安全

### 如何防止 sql 注入
SQL注入攻击（SQL Injection），简称注入攻击，是Web开发中最常见的一种安全漏洞。
可以用它来从数据库获取敏感信息，或者利用数据库的特性执行添加用户，导出文件等一系列恶意操作，甚至有可能获取数据库乃至系统用户最高权限。
- 1.	严格限制Web应用的数据库的操作权限，给此用户提供仅仅能够满足其工作的最低权限，从而最大限度的减少注入攻击对数据库的危害。
- 2.    检查输入的数据是否具有所期望的数据格式，严格限制变量的类型，例如使用regexp包进行一些匹配处理，或者使用strconv包对字符串转化成其他基本类型的数据进行判断。
- 3.    对进入数据库的特殊字符（'"\尖括号&*;等）进行转义处理，或编码转换。Go 的text/template包里面的HTMLEscapeString函数可以对字符串进行转义处理。
- 4.    所有的查询语句建议使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到SQL语句中，即不要直接拼接SQL语句。例如使用database/sql里面的查询函数Prepare和Query，或者Exec(query string, args ...interface{})。
- 5.    在应用发布之前建议使用专业的SQL注入检测工具进行检测，以及时修补被发现的SQL注入漏洞。网上有很多这方面的开源工具，例如sqlmap、SQLninja等。
- 6.    避免网站打印出SQL错误信息，比如类型错误、字段不匹配等，把代码里的SQL语句暴露出来，以防止攻击者利用这些错误信息进行SQL注入。